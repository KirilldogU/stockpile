- id: 2f90d4de-2612-4468-9251-b220e3727452
  name: Compress Git Repository
  description: This ability will compress a given git repository.
  tactic: exfiltration
  technique:
    attack_id: T1560.001
    name: 'Archive Collected Data: Archive via Utility'
  platforms:
    linux:
      sh:
        command: |
          tar -czf #{custom.git_dir}.tar.gz -C "#{custom.git_dir}" .; printf #{custom.git_dir}.tar.gz;
        cleanup: |
          rm #{custom.git_dir}.tar.gz;
        parsers:
          plugins.stockpile.app.parsers.basic:
            - source: file.staged_at
              edge: is_compressed
    windows:
      psh:
        command: |
          tar -czf #{custom.git_dir}.tar.gz -C #{custom.git_dir} *; Write-Host #{custom.git_dir}.tar.gz; exit 0;
        cleanup: |
          Remove-Item -Path #{custom.git_dir}.tar.gz;
        parsers:
          plugins.stockpile.app.parsers.basic:
            - source: file.staged_at
              edge: is_compressed
